var H=i=>{throw TypeError(i)};var fe=(i,e,t)=>e.has(i)||H("Cannot "+t);var K=(i,e,t)=>e.has(i)?H("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t);var c=(i,e,t)=>(fe(i,e,"access private method"),t);function be(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const R={extension:"webp",interval:100,loop:!0,publicPath:"/imgs/",autoPlay:!0,renderTarget:"canvas",fps:void 0,responsiveSwitching:!1};var a,Y,Z,P,G,J,X,ee,te,ie,re,ne;class me{constructor(e){K(this,a);if(this.options=c(this,a,te).call(this,e),c(this,a,ie).call(this,this.options),this.mountEl=document.getElementById(this.options.mountId),!this.mountEl)throw new Error('mountId="'.concat(this.options.mountId,'" の要素が見つかりません。'));this.canvasEl=null,this.ctx=null,this.imageEl=null,this.mountEl.innerHTML="",this.options.renderTarget==="canvas"?(this.canvasEl=document.createElement("canvas"),this.canvasEl.style.willChange="transform, opacity",this.canvasEl.style.display="block",this.canvasEl.style.width="100%",this.canvasEl.style.height="auto",this.mountEl.appendChild(this.canvasEl),this.ctx=this.canvasEl.getContext("2d",{alpha:!1})):(this.imageEl=document.createElement("img"),this.imageEl.decoding="async",this.imageEl.loading="eager",this.imageEl.style.display="block",this.imageEl.style.willChange="opacity",this.mountEl.appendChild(this.imageEl)),this.currentIndex=0,this.isPlaying=!1,this.isReady=!1,this.timerId=null,this.preloadPromise=null,this.preloadedFrames=[],this._frameInterval=1e3/(this.options.fps||1e3/this.options.interval),this._accumulator=0,this._lastTs=0,this._rafId=null,this.options.autoPlay&&this.preload().then(()=>this.play()).catch(t=>{console.error("自動再生に失敗しました:",t)})}async preload(){if(!this.isReady){if(!this.preloadPromise){const e=typeof createImageBitmap=="function";this.preloadPromise=Promise.all(this.options.imageNames.map(t=>c(this,a,G).call(this,t,e)))}try{this.preloadedFrames=await this.preloadPromise,this.isReady=!0;const e=this.preloadedFrames[0];if(e){const{width:t,height:s}=await c(this,a,X).call(this,e);if(this.canvasEl){const r=Math.max(1,Math.min(2,window.devicePixelRatio||1));this.canvasEl.width=Math.round(t*r),this.canvasEl.height=Math.round(s*r),this.canvasEl.style.aspectRatio="".concat(t," / ").concat(s),this.ctx&&this.ctx.setTransform(r,0,0,r,0,0)}c(this,a,P).call(this,0)}}catch(e){throw this.preloadPromise=null,e}}}async play(){if(this.isPlaying)return;if(await c(this,a,Y).call(this),this.preloadPromise&&await this.preloadPromise,!this.preloadedFrames.length){console.warn("再生可能なフレームが見つかりません。");return}this.isPlaying=!0,this._lastTs=performance.now();const e=t=>{if(!this.isPlaying)return;const s=t-this._lastTs;for(this._lastTs=t,this._accumulator+=s;this._accumulator>=this._frameInterval;)this._accumulator-=this._frameInterval,c(this,a,Z).call(this);this._rafId=requestAnimationFrame(e)};c(this,a,P).call(this,this.currentIndex),this._rafId=requestAnimationFrame(e)}pause(){this.isPlaying&&(this.isPlaying=!1,this._rafId!=null&&(cancelAnimationFrame(this._rafId),this._rafId=null),this.timerId!==null&&(clearInterval(this.timerId),this.timerId=null))}stop(){this.pause(),this.currentIndex=0,this.isReady&&this.preloadedFrames.length?c(this,a,P).call(this,0):(this.imageEl&&this.imageEl.removeAttribute("src"),this.ctx&&this.canvasEl&&this.ctx.clearRect(0,0,this.canvasEl.width,this.canvasEl.height))}setSpeed(e){if(!Number.isFinite(e)||e<=0){console.warn("setSpeed: 正の数値を指定してください。");return}this.options.interval=e,this.options.fps=void 0,this._frameInterval=e}setFps(e){if(!Number.isFinite(e)||e<=0){console.warn("setFps: 正の数値を指定してください。");return}this.options.fps=e,this._frameInterval=1e3/e}setLoop(e){this.options.loop=!!e}dispose(){this.stop(),this.mountEl.innerHTML="";for(const e of this.preloadedFrames)if("close"in e&&typeof e.close=="function")try{e.close()}catch(t){}this.preloadedFrames=[],this.preloadPromise=null,this.isReady=!1,this.canvasEl=null,this.ctx=null,this.imageEl=null}destroy(){this.dispose()}}a=new WeakSet,Y=async function(){this.isReady||await this.preload()},Z=function(){if(!this.preloadedFrames.length)return;let e=this.currentIndex+1;if(e>=this.preloadedFrames.length)if(this.options.loop)e=0;else{this.pause();return}this.currentIndex=e,c(this,a,P).call(this,this.currentIndex)},P=function(e){const t=this.preloadedFrames[e];if(t)if(this.currentIndex=e,this.ctx&&this.canvasEl){const{width:s,height:r}=this.canvasEl;this.ctx.clearRect(0,0,s,r),t instanceof ImageBitmap?this.ctx.drawImage(t,0,0,s,r):this.ctx.drawImage(t,0,0,s,r)}else this.imageEl&&(t instanceof ImageBitmap?console.warn('renderTarget: "img" では ImageBitmap を直接表示できません。canvas を使用してください。'):this.imageEl.src=t.src)},G=async function(e,t){const s=c(this,a,ee).call(this,e);try{const r=await fetch(s,{cache:"force-cache",credentials:"same-origin"});if(!r.ok)throw new Error("HTTP ".concat(r.status));const o=await r.blob();if(t)return await createImageBitmap(o);{const m=URL.createObjectURL(o),h=new Image;h.decoding="async";const x=()=>{try{URL.revokeObjectURL(m)}catch(L){}};try{return await new Promise((L,_)=>{h.onload=L,h.onerror=()=>_(new Error("画像の読み込みに失敗: ".concat(s))),h.src=m}),typeof h.decode=="function"&&await h.decode(),h}finally{h.src=s,x()}}}catch(r){return await c(this,a,J).call(this,s)}},J=function(e){return new Promise((t,s)=>{const r=new Image;r.decoding="async",r.onload=async()=>{try{typeof r.decode=="function"&&await r.decode()}catch(o){console.warn("decode に失敗しましたが処理を継続します:",o)}t(r)},r.onerror=()=>s(new Error("画像の読み込みに失敗しました: ".concat(e))),r.src=e})},X=async function(e){return e instanceof ImageBitmap?{width:e.width,height:e.height}:{width:e.naturalWidth,height:e.naturalHeight}},ee=function(e){return"".concat(this.options.publicPath).concat(e,".").concat(this.options.extension)},te=function(e){const t={...R,...e||{}};return t.publicPath=c(this,a,re).call(this,t.publicPath),t.fps!=null&&Number.isFinite(Number(t.fps))&&Number(t.fps)>0?(t.fps=Number(t.fps),t.interval=1e3/t.fps):t.interval=c(this,a,ne).call(this,t.interval),t.renderTarget!=="canvas"&&t.renderTarget!=="img"&&(t.renderTarget=R.renderTarget),t},ie=function(e){if(!e.mountId)throw new Error("mountId を指定してください。");if(!Array.isArray(e.imageNames)||e.imageNames.length===0)throw new Error("imageNames には1件以上のファイル名を指定してください。");if(!e.extension)throw new Error("extension を指定してください。")},re=function(e){return typeof e!="string"||e.length===0?R.publicPath:e.endsWith("/")?e:"".concat(e,"/")},ne=function(e){const t=Number(e);return!Number.isFinite(t)||t<=0?R.interval:t};const q=Array.from({length:101},(i,e)=>"takasaki_".concat(String(e).padStart(4,"0"))),pe="(max-width: 900px)",ye=900,ge=150,we={desktop:{imageNames:q,publicPath:"./imgs/desktop/"},mobile:{imageNames:q,publicPath:"./imgs/mobile/"}},se={mountId:"player",extension:"jpeg",interval:80,loop:!0,autoPlay:!1,responsiveSwitching:!0},v=ve({variants:we,playerOptions:se,breakpointQuery:pe,breakpointWidth:ye,debounceMs:ge});var Q;const D=(Q=document.getElementById(se.mountId))==null?void 0:Q.closest(".demo__viewport"),S=document.getElementById("resize-button");v.onVariantChange(({variantKey:i})=>{D&&D.setAttribute("data-variant",i||""),S&&(S.dataset.variant=i||"",S.textContent=i?"サイズ変更 (".concat(i,")"):"サイズ変更")});function b(i,e){const t=document.getElementById(i);if(!(t instanceof HTMLButtonElement)){console.warn("".concat(i," ボタンが見つかりませんでした。"));return}e(t)}b("preload-button",i=>{i.addEventListener("click",async()=>{var s;const e=v.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}i.disabled=!0;const t=(s=i.textContent)!=null?s:"プリロード";i.textContent="プリロード中...";try{await e.preload(),i.textContent="プリロード完了"}catch(r){console.error("プリロードに失敗しました:",r),i.textContent="プリロード失敗"}finally{setTimeout(()=>{i.textContent=t,i.disabled=!1},600)}})});b("play-button",i=>{i.addEventListener("click",async()=>{var s;const e=v.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}i.disabled=!0;const t=(s=i.textContent)!=null?s:"再生";i.textContent="再生準備中...";try{await e.play(),i.textContent="再生中"}catch(r){console.error("再生に失敗しました:",r),i.textContent="再生失敗"}finally{setTimeout(()=>{i.textContent=t,i.disabled=!1},400)}})});b("pause-button",i=>{i.addEventListener("click",()=>{const e=v.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}e.pause()})});b("stop-button",i=>{i.addEventListener("click",()=>{const e=v.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}e.stop()})});b("resize-button",i=>{i.addEventListener("click",async()=>{try{await v.cycleVariant()}catch(e){console.error("サイズ変更に失敗しました:",e)}})});function ve({variants:i,playerOptions:e,breakpointQuery:t,breakpointWidth:s,debounceMs:r}){const o=i!=null?i:{},m=Object.keys(o),h=m;if(m.length===0)throw new Error("最小1種類の画像セットを指定してください。");const x=Object.prototype.hasOwnProperty.call(o,"desktop"),L=Object.prototype.hasOwnProperty.call(o,"mobile"),_=x?"desktop":m[0],ae=t,oe=Number.isFinite(s)?Number(s):900,le=Number.isFinite(r)?Number(r):150;let f=null,d=null,E=!!(e!=null&&e.responsiveSwitching),u=null,C=null,T=!1,g=Promise.resolve();const V=new Set,ce=n=>{for(const l of V)try{l(n)}catch(p){console.error("variant listener の呼び出しに失敗しました:",p)}},w=typeof window<"u";w&&typeof window.matchMedia=="function"&&(u=window.matchMedia(ae));const O=n=>n&&L?"mobile":!n&&x?"desktop":_,k=()=>{if(!w)return _;if(u)return O(u.matches);const l=(window.innerWidth||0)<=oe;return O(l)},A=async(n,{preserveState:l}={})=>{if(!n)return{player:f,variantKey:d};if(n===d&&f)return{player:f,variantKey:d};const p=o[n];if(!p)return console.warn('未定義のvariant "'.concat(n,'" が指定されました。')),{player:f,variantKey:d};const y=f,W=!!l,de=W&&(y==null?void 0:y.isPlaying)===!0,ue=W&&(y==null?void 0:y.isReady)===!0;if(y)try{y.destroy()}catch(I){console.warn("既存プレイヤーの破棄に失敗しました:",I)}const N=new me({...e,...p});if(f=N,d=n,ue)try{await N.preload()}catch(I){console.error("プリロードの再実行に失敗しました:",I)}de&&N.play().catch(I=>{console.error("切り替え後の再生再開に失敗しました:",I)});const j={player:N,variantKey:n};return ce(j),j},$=(n,l={})=>(g=g.catch(()=>{}).then(()=>A(n,l)),g=g.catch(p=>(console.error("画像バリアントの切り替えに失敗しました:",p),{player:f,variantKey:d})),g),B=(n={})=>{!w||!E||(window.clearTimeout(C),C=window.setTimeout(()=>{const l=k();l&&l!==d&&$(l,n)},le))},F=()=>B({preserveState:!0}),M=()=>B({preserveState:!0}),z=()=>{!w||T||(T=!0,u&&(typeof u.addEventListener=="function"?u.addEventListener("change",F):typeof u.addListener=="function"&&u.addListener(F)),window.addEventListener("resize",M))},he=()=>{!w||!T||(T=!1,window.clearTimeout(C),u&&(typeof u.removeEventListener=="function"?u.removeEventListener("change",F):typeof u.removeListener=="function"&&u.removeListener(F)),window.removeEventListener("resize",M))};w&&(g=A(k(),{preserveState:!1}).catch(n=>(console.error("初期バリアントの設定に失敗しました:",n),{player:f,variantKey:d})),E&&z());const U=(n,l={})=>o[n]?$(n,l):(console.warn('forceVariant: 未定義のvariant "'.concat(n,'" が指定されました。')),Promise.resolve({player:f,variantKey:d}));return{getPlayer:()=>f,getVariant:()=>d,getVariants:()=>[...h],onVariantChange(n){return typeof n!="function"?()=>{}:(V.add(n),d&&n({player:f,variantKey:d}),()=>{V.delete(n)})},setResponsiveSwitching(n){const l=!!n;l!==E&&(E=l,E?(z(),B({preserveState:!0})):he())},forceVariant:U,cycleVariant:()=>{if(!h.length)return Promise.resolve({player:f,variantKey:d});const n=h.indexOf(d),l=n>=0?(n+1)%h.length:0,p=h[l];return U(p,{preserveState:!0})}}}export{be as __vite_legacy_guard};
