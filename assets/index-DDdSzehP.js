var z=i=>{throw TypeError(i)};var ae=(i,e,t)=>e.has(i)||z("Cannot "+t);var K=(i,e,t)=>e.has(i)?z("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t);var c=(i,e,t)=>(ae(i,e,"access private method"),t);function ge(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();const R={extension:"webp",interval:100,loop:!0,publicPath:"/imgs/",autoPlay:!0,renderTarget:"canvas",fps:void 0,responsiveSwitching:!1};var s,j,H,E,q,D,Q,Y,Z,G,J,X;class oe{constructor(e){K(this,s);if(this.options=c(this,s,Z).call(this,e),c(this,s,G).call(this,this.options),this.mountEl=document.getElementById(this.options.mountId),!this.mountEl)throw new Error('mountId="'.concat(this.options.mountId,'" の要素が見つかりません。'));this.canvasEl=null,this.ctx=null,this.imageEl=null,this.mountEl.innerHTML="",this.options.renderTarget==="canvas"?(this.canvasEl=document.createElement("canvas"),this.canvasEl.style.willChange="transform, opacity",this.canvasEl.style.display="block",this.canvasEl.style.width="100%",this.canvasEl.style.height="auto",this.mountEl.appendChild(this.canvasEl),this.ctx=this.canvasEl.getContext("2d",{alpha:!1})):(this.imageEl=document.createElement("img"),this.imageEl.decoding="async",this.imageEl.loading="eager",this.imageEl.style.display="block",this.imageEl.style.willChange="opacity",this.mountEl.appendChild(this.imageEl)),this.currentIndex=0,this.isPlaying=!1,this.isReady=!1,this.timerId=null,this.preloadPromise=null,this.preloadedFrames=[],this._frameInterval=1e3/(this.options.fps||1e3/this.options.interval),this._accumulator=0,this._lastTs=0,this._rafId=null,this.options.autoPlay&&this.preload().then(()=>this.play()).catch(t=>{console.error("自動再生に失敗しました:",t)})}async preload(){if(!this.isReady){if(!this.preloadPromise){const e=typeof createImageBitmap=="function";this.preloadPromise=Promise.all(this.options.imageNames.map(t=>c(this,s,q).call(this,t,e)))}try{this.preloadedFrames=await this.preloadPromise,this.isReady=!0;const e=this.preloadedFrames[0];if(e){const{width:t,height:n}=await c(this,s,Q).call(this,e);if(this.canvasEl){const r=Math.max(1,Math.min(2,window.devicePixelRatio||1));this.canvasEl.width=Math.round(t*r),this.canvasEl.height=Math.round(n*r),this.canvasEl.style.aspectRatio="".concat(t," / ").concat(n),this.ctx&&this.ctx.setTransform(r,0,0,r,0,0)}c(this,s,E).call(this,0)}}catch(e){throw this.preloadPromise=null,e}}}async play(){if(this.isPlaying)return;if(await c(this,s,j).call(this),this.preloadPromise&&await this.preloadPromise,!this.preloadedFrames.length){console.warn("再生可能なフレームが見つかりません。");return}this.isPlaying=!0,this._lastTs=performance.now();const e=t=>{if(!this.isPlaying)return;const n=t-this._lastTs;for(this._lastTs=t,this._accumulator+=n;this._accumulator>=this._frameInterval;)this._accumulator-=this._frameInterval,c(this,s,H).call(this);this._rafId=requestAnimationFrame(e)};c(this,s,E).call(this,this.currentIndex),this._rafId=requestAnimationFrame(e)}pause(){this.isPlaying&&(this.isPlaying=!1,this._rafId!=null&&(cancelAnimationFrame(this._rafId),this._rafId=null),this.timerId!==null&&(clearInterval(this.timerId),this.timerId=null))}stop(){this.pause(),this.currentIndex=0,this.isReady&&this.preloadedFrames.length?c(this,s,E).call(this,0):(this.imageEl&&this.imageEl.removeAttribute("src"),this.ctx&&this.canvasEl&&this.ctx.clearRect(0,0,this.canvasEl.width,this.canvasEl.height))}setSpeed(e){if(!Number.isFinite(e)||e<=0){console.warn("setSpeed: 正の数値を指定してください。");return}this.options.interval=e,this.options.fps=void 0,this._frameInterval=e}setFps(e){if(!Number.isFinite(e)||e<=0){console.warn("setFps: 正の数値を指定してください。");return}this.options.fps=e,this._frameInterval=1e3/e}setLoop(e){this.options.loop=!!e}dispose(){this.stop(),this.mountEl.innerHTML="";for(const e of this.preloadedFrames)if("close"in e&&typeof e.close=="function")try{e.close()}catch(t){}this.preloadedFrames=[],this.preloadPromise=null,this.isReady=!1,this.canvasEl=null,this.ctx=null,this.imageEl=null}destroy(){this.dispose()}}s=new WeakSet,j=async function(){this.isReady||await this.preload()},H=function(){if(!this.preloadedFrames.length)return;let e=this.currentIndex+1;if(e>=this.preloadedFrames.length)if(this.options.loop)e=0;else{this.pause();return}this.currentIndex=e,c(this,s,E).call(this,this.currentIndex)},E=function(e){const t=this.preloadedFrames[e];if(t)if(this.currentIndex=e,this.ctx&&this.canvasEl){const{width:n,height:r}=this.canvasEl;this.ctx.clearRect(0,0,n,r),t instanceof ImageBitmap?this.ctx.drawImage(t,0,0,n,r):this.ctx.drawImage(t,0,0,n,r)}else this.imageEl&&(t instanceof ImageBitmap?console.warn('renderTarget: "img" では ImageBitmap を直接表示できません。canvas を使用してください。'):this.imageEl.src=t.src)},q=async function(e,t){const n=c(this,s,Y).call(this,e);try{const r=await fetch(n,{cache:"force-cache",credentials:"same-origin"});if(!r.ok)throw new Error("HTTP ".concat(r.status));const o=await r.blob();if(t)return await createImageBitmap(o);{const u=URL.createObjectURL(o),h=new Image;h.decoding="async";const x=()=>{try{URL.revokeObjectURL(u)}catch(b){}};try{return await new Promise((b,L)=>{h.onload=b,h.onerror=()=>L(new Error("画像の読み込みに失敗: ".concat(n))),h.src=u}),typeof h.decode=="function"&&await h.decode(),h}finally{h.src=n,x()}}}catch(r){return await c(this,s,D).call(this,n)}},D=function(e){return new Promise((t,n)=>{const r=new Image;r.decoding="async",r.onload=async()=>{try{typeof r.decode=="function"&&await r.decode()}catch(o){console.warn("decode に失敗しましたが処理を継続します:",o)}t(r)},r.onerror=()=>n(new Error("画像の読み込みに失敗しました: ".concat(e))),r.src=e})},Q=async function(e){return e instanceof ImageBitmap?{width:e.width,height:e.height}:{width:e.naturalWidth,height:e.naturalHeight}},Y=function(e){return"".concat(this.options.publicPath).concat(e,".").concat(this.options.extension)},Z=function(e){const t={...R,...e||{}};return t.publicPath=c(this,s,J).call(this,t.publicPath),t.fps!=null&&Number.isFinite(Number(t.fps))&&Number(t.fps)>0?(t.fps=Number(t.fps),t.interval=1e3/t.fps):t.interval=c(this,s,X).call(this,t.interval),t.renderTarget!=="canvas"&&t.renderTarget!=="img"&&(t.renderTarget=R.renderTarget),t},G=function(e){if(!e.mountId)throw new Error("mountId を指定してください。");if(!Array.isArray(e.imageNames)||e.imageNames.length===0)throw new Error("imageNames には1件以上のファイル名を指定してください。");if(!e.extension)throw new Error("extension を指定してください。")},J=function(e){return typeof e!="string"||e.length===0?R.publicPath:e.endsWith("/")?e:"".concat(e,"/")},X=function(e){const t=Number(e);return!Number.isFinite(t)||t<=0?R.interval:t};const W=Array.from({length:101},(i,e)=>"takasaki_".concat(String(e).padStart(4,"0"))),le="(max-width: 900px)",ce=900,he=150,de={desktop:{imageNames:W,publicPath:"./imgs/desktop/"},mobile:{imageNames:W,publicPath:"./imgs/mobile/"}},ue={mountId:"player",extension:"jpeg",interval:80,loop:!0,autoPlay:!1,responsiveSwitching:!0},I=fe({variants:de,playerOptions:ue,breakpointQuery:le,breakpointWidth:ce,debounceMs:he});function P(i,e){const t=document.getElementById(i);if(!(t instanceof HTMLButtonElement)){console.warn("".concat(i," ボタンが見つかりませんでした。"));return}e(t)}P("preload-button",i=>{i.addEventListener("click",async()=>{var n;const e=I.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}i.disabled=!0;const t=(n=i.textContent)!=null?n:"プリロード";i.textContent="プリロード中...";try{await e.preload(),i.textContent="プリロード完了"}catch(r){console.error("プリロードに失敗しました:",r),i.textContent="プリロード失敗"}finally{setTimeout(()=>{i.textContent=t,i.disabled=!1},600)}})});P("play-button",i=>{i.addEventListener("click",async()=>{var n;const e=I.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}i.disabled=!0;const t=(n=i.textContent)!=null?n:"再生";i.textContent="再生準備中...";try{await e.play(),i.textContent="再生中"}catch(r){console.error("再生に失敗しました:",r),i.textContent="再生失敗"}finally{setTimeout(()=>{i.textContent=t,i.disabled=!1},400)}})});P("pause-button",i=>{i.addEventListener("click",()=>{const e=I.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}e.pause()})});P("stop-button",i=>{i.addEventListener("click",()=>{const e=I.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}e.stop()})});P("resize-button",i=>{i.addEventListener("click",async()=>{try{const e=await I.cycleVariant();e!=null&&e.variantKey&&(i.textContent="サイズ変更 (".concat(e.variantKey,")"))}catch(e){console.error("サイズ変更に失敗しました:",e)}})});function fe({variants:i,playerOptions:e,breakpointQuery:t,breakpointWidth:n,debounceMs:r}){const o=i!=null?i:{},u=Object.keys(o),h=u;if(u.length===0)throw new Error("最小1種類の画像セットを指定してください。");const x=Object.prototype.hasOwnProperty.call(o,"desktop"),b=Object.prototype.hasOwnProperty.call(o,"mobile"),L=x?"desktop":u[0],ee=t,te=Number.isFinite(n)?Number(n):900,ie=Number.isFinite(r)?Number(r):150;let m=null,f=null,w=!!(e!=null&&e.responsiveSwitching),d=null,C=null,_=!1,T=Promise.resolve();const y=typeof window<"u";y&&typeof window.matchMedia=="function"&&(d=window.matchMedia(ee));const B=a=>a&&b?"mobile":!a&&x?"desktop":L,S=()=>{if(!y)return L;if(d)return B(d.matches);const l=(window.innerWidth||0)<=te;return B(l)},O=async(a,{preserveState:l}={})=>{if(!a)return{player:m,variantKey:f};if(a===f&&m)return{player:m,variantKey:f};const g=o[a];if(!g)return console.warn('未定義のvariant "'.concat(a,'" が指定されました。')),{player:m,variantKey:f};const p=m,U=!!l,ne=U&&(p==null?void 0:p.isPlaying)===!0,se=U&&(p==null?void 0:p.isReady)===!0;if(p)try{p.destroy()}catch(v){console.warn("既存プレイヤーの破棄に失敗しました:",v)}const N=new oe({...e,...g});if(m=N,f=a,se)try{await N.preload()}catch(v){console.error("プリロードの再実行に失敗しました:",v)}return ne&&N.play().catch(v=>{console.error("切り替え後の再生再開に失敗しました:",v)}),{player:N,variantKey:a}},k=(a,l={})=>(T=T.catch(()=>{}).then(()=>O(a,l)).catch(g=>{console.error("画像バリアントの切り替えに失敗しました:",g)}),T),V=(a={})=>{!y||!w||(window.clearTimeout(C),C=window.setTimeout(()=>{const l=S();l&&l!==f&&k(l,a)},ie))},F=()=>V({preserveState:!0}),A=()=>V({preserveState:!0}),$=()=>{!y||_||(_=!0,d&&(typeof d.addEventListener=="function"?d.addEventListener("change",F):typeof d.addListener=="function"&&d.addListener(F)),window.addEventListener("resize",A))},re=()=>{!y||!_||(_=!1,window.clearTimeout(C),d&&(typeof d.removeEventListener=="function"?d.removeEventListener("change",F):typeof d.removeListener=="function"&&d.removeListener(F)),window.removeEventListener("resize",A))};y&&(T=O(S(),{preserveState:!1}),w&&$());const M=(a,l={})=>o[a]?k(a,l):(console.warn('forceVariant: 未定義のvariant "'.concat(a,'" が指定されました。')),Promise.resolve({player:m,variantKey:f}));return{getPlayer:()=>m,getVariant:()=>f,getVariants:()=>[...h],setResponsiveSwitching(a){const l=!!a;l!==w&&(w=l,w?($(),V({preserveState:!0})):re())},forceVariant:M,cycleVariant:()=>{if(!h.length)return Promise.resolve({player:m,variantKey:f});const a=h.indexOf(f),l=a>=0?(a+1)%h.length:0,g=h[l];return M(g,{preserveState:!0})}}}export{ge as __vite_legacy_guard};
