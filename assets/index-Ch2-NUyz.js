var $=s=>{throw TypeError(s)};var re=(s,e,t)=>e.has(s)||$("Cannot "+t);var U=(s,e,t)=>e.has(s)?$("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);var l=(s,e,t)=>(re(s,e,"access private method"),t);function me(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const _={extension:"webp",interval:100,loop:!0,publicPath:"/imgs/",autoPlay:!0,renderTarget:"canvas",fps:void 0,responsiveSwitching:!1};var n,j,z,v,H,q,D,Q,K,Y,Z,G;class ne{constructor(e){U(this,n);if(this.options=l(this,n,K).call(this,e),l(this,n,Y).call(this,this.options),this.mountEl=document.getElementById(this.options.mountId),!this.mountEl)throw new Error('mountId="'.concat(this.options.mountId,'" の要素が見つかりません。'));this.canvasEl=null,this.ctx=null,this.imageEl=null,this.mountEl.innerHTML="",this.options.renderTarget==="canvas"?(this.canvasEl=document.createElement("canvas"),this.canvasEl.style.willChange="transform, opacity",this.canvasEl.style.display="block",this.canvasEl.style.width="100%",this.canvasEl.style.height="auto",this.mountEl.appendChild(this.canvasEl),this.ctx=this.canvasEl.getContext("2d",{alpha:!1})):(this.imageEl=document.createElement("img"),this.imageEl.decoding="async",this.imageEl.loading="eager",this.imageEl.style.display="block",this.imageEl.style.willChange="opacity",this.mountEl.appendChild(this.imageEl)),this.currentIndex=0,this.isPlaying=!1,this.isReady=!1,this.timerId=null,this.preloadPromise=null,this.preloadedFrames=[],this._frameInterval=1e3/(this.options.fps||1e3/this.options.interval),this._accumulator=0,this._lastTs=0,this._rafId=null,this.options.autoPlay&&this.preload().then(()=>this.play()).catch(t=>{console.error("自動再生に失敗しました:",t)})}async preload(){if(!this.isReady){if(!this.preloadPromise){const e=typeof createImageBitmap=="function";this.preloadPromise=Promise.all(this.options.imageNames.map(t=>l(this,n,H).call(this,t,e)))}try{this.preloadedFrames=await this.preloadPromise,this.isReady=!0;const e=this.preloadedFrames[0];if(e){const{width:t,height:r}=await l(this,n,D).call(this,e);if(this.canvasEl){const i=Math.max(1,Math.min(2,window.devicePixelRatio||1));this.canvasEl.width=Math.round(t*i),this.canvasEl.height=Math.round(r*i),this.canvasEl.style.aspectRatio="".concat(t," / ").concat(r),this.ctx&&this.ctx.setTransform(i,0,0,i,0,0)}l(this,n,v).call(this,0)}}catch(e){throw this.preloadPromise=null,e}}}async play(){if(this.isPlaying)return;if(await l(this,n,j).call(this),this.preloadPromise&&await this.preloadPromise,!this.preloadedFrames.length){console.warn("再生可能なフレームが見つかりません。");return}this.isPlaying=!0,this._lastTs=performance.now();const e=t=>{if(!this.isPlaying)return;const r=t-this._lastTs;for(this._lastTs=t,this._accumulator+=r;this._accumulator>=this._frameInterval;)this._accumulator-=this._frameInterval,l(this,n,z).call(this);this._rafId=requestAnimationFrame(e)};l(this,n,v).call(this,this.currentIndex),this._rafId=requestAnimationFrame(e)}pause(){this.isPlaying&&(this.isPlaying=!1,this._rafId!=null&&(cancelAnimationFrame(this._rafId),this._rafId=null),this.timerId!==null&&(clearInterval(this.timerId),this.timerId=null))}stop(){this.pause(),this.currentIndex=0,this.isReady&&this.preloadedFrames.length?l(this,n,v).call(this,0):(this.imageEl&&this.imageEl.removeAttribute("src"),this.ctx&&this.canvasEl&&this.ctx.clearRect(0,0,this.canvasEl.width,this.canvasEl.height))}setSpeed(e){if(!Number.isFinite(e)||e<=0){console.warn("setSpeed: 正の数値を指定してください。");return}this.options.interval=e,this.options.fps=void 0,this._frameInterval=e}setFps(e){if(!Number.isFinite(e)||e<=0){console.warn("setFps: 正の数値を指定してください。");return}this.options.fps=e,this._frameInterval=1e3/e}setLoop(e){this.options.loop=!!e}dispose(){this.stop(),this.mountEl.innerHTML="";for(const e of this.preloadedFrames)if("close"in e&&typeof e.close=="function")try{e.close()}catch(t){}this.preloadedFrames=[],this.preloadPromise=null,this.isReady=!1,this.canvasEl=null,this.ctx=null,this.imageEl=null}destroy(){this.dispose()}}n=new WeakSet,j=async function(){this.isReady||await this.preload()},z=function(){if(!this.preloadedFrames.length)return;let e=this.currentIndex+1;if(e>=this.preloadedFrames.length)if(this.options.loop)e=0;else{this.pause();return}this.currentIndex=e,l(this,n,v).call(this,this.currentIndex)},v=function(e){const t=this.preloadedFrames[e];if(t)if(this.currentIndex=e,this.ctx&&this.canvasEl){const{width:r,height:i}=this.canvasEl;this.ctx.clearRect(0,0,r,i),t instanceof ImageBitmap?this.ctx.drawImage(t,0,0,r,i):this.ctx.drawImage(t,0,0,r,i)}else this.imageEl&&(t instanceof ImageBitmap?console.warn('renderTarget: "img" では ImageBitmap を直接表示できません。canvas を使用してください。'):this.imageEl.src=t.src)},H=async function(e,t){const r=l(this,n,Q).call(this,e);try{const i=await fetch(r,{cache:"force-cache",credentials:"same-origin"});if(!i.ok)throw new Error("HTTP ".concat(i.status));const a=await i.blob();if(t)return await createImageBitmap(a);{const u=URL.createObjectURL(a),d=new Image;d.decoding="async";const N=()=>{try{URL.revokeObjectURL(u)}catch(g){}};try{return await new Promise((g,R)=>{d.onload=g,d.onerror=()=>R(new Error("画像の読み込みに失敗: ".concat(r))),d.src=u}),typeof d.decode=="function"&&await d.decode(),d}finally{d.src=r,N()}}}catch(i){return await l(this,n,q).call(this,r)}},q=function(e){return new Promise((t,r)=>{const i=new Image;i.decoding="async",i.onload=async()=>{try{typeof i.decode=="function"&&await i.decode()}catch(a){console.warn("decode に失敗しましたが処理を継続します:",a)}t(i)},i.onerror=()=>r(new Error("画像の読み込みに失敗しました: ".concat(e))),i.src=e})},D=async function(e){return e instanceof ImageBitmap?{width:e.width,height:e.height}:{width:e.naturalWidth,height:e.naturalHeight}},Q=function(e){return"".concat(this.options.publicPath).concat(e,".").concat(this.options.extension)},K=function(e){const t={..._,...e||{}};return t.publicPath=l(this,n,Z).call(this,t.publicPath),t.fps!=null&&Number.isFinite(Number(t.fps))&&Number(t.fps)>0?(t.fps=Number(t.fps),t.interval=1e3/t.fps):t.interval=l(this,n,G).call(this,t.interval),t.renderTarget!=="canvas"&&t.renderTarget!=="img"&&(t.renderTarget=_.renderTarget),t},Y=function(e){if(!e.mountId)throw new Error("mountId を指定してください。");if(!Array.isArray(e.imageNames)||e.imageNames.length===0)throw new Error("imageNames には1件以上のファイル名を指定してください。");if(!e.extension)throw new Error("extension を指定してください。")},Z=function(e){return typeof e!="string"||e.length===0?_.publicPath:e.endsWith("/")?e:"".concat(e,"/")},G=function(e){const t=Number(e);return!Number.isFinite(t)||t<=0?_.interval:t};const W=Array.from({length:101},(s,e)=>"takasaki_".concat(String(e).padStart(4,"0"))),ae="(max-width: 900px)",oe=900,le=150,ce={desktop:{imageNames:W,publicPath:"./imgs/desktop/"},mobile:{imageNames:W,publicPath:"./imgs/mobile/"}},he={mountId:"player",extension:"jpeg",interval:80,loop:!0,autoPlay:!1,responsiveSwitching:!1},T=de({variants:ce,playerOptions:he,breakpointQuery:ae,breakpointWidth:oe,debounceMs:le});function F(s,e){const t=document.getElementById(s);if(!(t instanceof HTMLButtonElement)){console.warn("".concat(s," ボタンが見つかりませんでした。"));return}e(t)}F("preload-button",s=>{s.addEventListener("click",async()=>{var r;const e=T.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}s.disabled=!0;const t=(r=s.textContent)!=null?r:"プリロード";s.textContent="プリロード中...";try{await e.preload(),s.textContent="プリロード完了"}catch(i){console.error("プリロードに失敗しました:",i),s.textContent="プリロード失敗"}finally{setTimeout(()=>{s.textContent=t,s.disabled=!1},600)}})});F("play-button",s=>{s.addEventListener("click",async()=>{var r;const e=T.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}s.disabled=!0;const t=(r=s.textContent)!=null?r:"再生";s.textContent="再生準備中...";try{await e.play(),s.textContent="再生中"}catch(i){console.error("再生に失敗しました:",i),s.textContent="再生失敗"}finally{setTimeout(()=>{s.textContent=t,s.disabled=!1},400)}})});F("pause-button",s=>{s.addEventListener("click",()=>{const e=T.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}e.pause()})});F("stop-button",s=>{s.addEventListener("click",()=>{const e=T.getPlayer();if(!e){console.warn("プレイヤーが初期化されていません。");return}e.stop()})});function de({variants:s,playerOptions:e,breakpointQuery:t,breakpointWidth:r,debounceMs:i}){const a=s!=null?s:{},u=Object.keys(a);if(u.length===0)throw new Error("最小1種類の画像セットを指定してください。");const d=Object.prototype.hasOwnProperty.call(a,"desktop"),N=Object.prototype.hasOwnProperty.call(a,"mobile"),g=d?"desktop":u[0],R=t,J=Number.isFinite(r)?Number(r):900,X=Number.isFinite(i)?Number(i):150;let m=null,E=null,y=!!(e!=null&&e.responsiveSwitching),c=null,B=null,I=!1,P=Promise.resolve();const p=typeof window<"u";p&&typeof window.matchMedia=="function"&&(c=window.matchMedia(R));const S=o=>o&&N?"mobile":!o&&d?"desktop":g,O=()=>{if(!p)return g;if(c)return S(c.matches);const h=(window.innerWidth||0)<=J;return S(h)},k=async(o,{preserveState:h}={})=>{if(!o||o===E&&m)return m;const x=a[o];if(!x)return console.warn('未定義のvariant "'.concat(o,'" が指定されました。')),m;const f=m,V=!!h,ie=V&&(f==null?void 0:f.isPlaying)===!0,se=V&&(f==null?void 0:f.isReady)===!0;if(f)try{f.destroy()}catch(w){console.warn("既存プレイヤーの破棄に失敗しました:",w)}const L=new ne({...e,...x});if(m=L,E=o,se)try{await L.preload()}catch(w){console.error("プリロードの再実行に失敗しました:",w)}return ie&&L.play().catch(w=>{console.error("切り替え後の再生再開に失敗しました:",w)}),L},ee=(o,h={})=>(P=P.catch(()=>{}).then(()=>k(o,h)).catch(x=>{console.error("画像バリアントの切り替えに失敗しました:",x)}),P),C=(o={})=>{!p||!y||(window.clearTimeout(B),B=window.setTimeout(()=>{const h=O();h&&h!==E&&ee(h,o)},X))},b=()=>C({preserveState:!0}),A=()=>C({preserveState:!0}),M=()=>{!p||I||(I=!0,c&&(typeof c.addEventListener=="function"?c.addEventListener("change",b):typeof c.addListener=="function"&&c.addListener(b)),window.addEventListener("resize",A))},te=()=>{!p||!I||(I=!1,window.clearTimeout(B),c&&(typeof c.removeEventListener=="function"?c.removeEventListener("change",b):typeof c.removeListener=="function"&&c.removeListener(b)),window.removeEventListener("resize",A))};return p&&(P=k(O(),{preserveState:!1}),y&&M()),{getPlayer:()=>m,getVariant:()=>E,setResponsiveSwitching(o){const h=!!o;h!==y&&(y=h,y?(M(),C({preserveState:!0})):te())}}}export{me as __vite_legacy_guard};
