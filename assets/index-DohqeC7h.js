var m=t=>{throw TypeError(t)};var v=(t,e,i)=>e.has(t)||m("Cannot "+i);var p=(t,e,i)=>e.has(t)?m("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i);var o=(t,e,i)=>(v(t,e,"access private method"),i);function C(){import.meta.url,import("_").catch(()=>1),(async function*(){})().next()}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const u={extension:"jpeg",interval:100,loop:!0,publicPath:"/imgs/",autoPlay:!0};var r,f,g,d,y,I,P,w,E,x;class L{constructor(e){p(this,r);if(this.options=o(this,r,P).call(this,e),o(this,r,w).call(this,this.options),this.mountEl=document.getElementById(this.options.mountId),!this.mountEl)throw new Error('mountId="'.concat(this.options.mountId,'" の要素が見つかりません。'));this.imageEl=document.createElement("img"),this.imageEl.decoding="async",this.imageEl.loading="eager",this.mountEl.innerHTML="",this.mountEl.appendChild(this.imageEl),this.currentIndex=0,this.isPlaying=!1,this.isReady=!1,this.timerId=null,this.preloadPromise=null,this.preloadedImages=[],this.options.autoPlay&&this.preload().then(()=>this.play()).catch(i=>{console.error("自動再生に失敗しました:",i)})}async preload(){if(!this.isReady){this.preloadPromise||(this.preloadPromise=Promise.all(this.options.imageNames.map(e=>o(this,r,y).call(this,e))));try{this.preloadedImages=await this.preloadPromise,this.isReady=!0,this.preloadedImages.length&&o(this,r,d).call(this,0)}catch(e){throw this.preloadPromise=null,e}}}async play(){if(!this.isPlaying){if(await o(this,r,f).call(this),this.preloadPromise&&await this.preloadPromise,!this.preloadedImages.length){console.warn("再生可能な画像が見つかりません。");return}this.isPlaying=!0,o(this,r,d).call(this,this.currentIndex),this.timerId=window.setInterval(()=>{o(this,r,g).call(this)},this.options.interval)}}pause(){this.isPlaying&&(this.timerId!==null&&(clearInterval(this.timerId),this.timerId=null),this.isPlaying=!1)}stop(){this.pause(),this.currentIndex=0,this.isReady&&this.preloadedImages.length?o(this,r,d).call(this,0):this.imageEl.removeAttribute("src")}setSpeed(e){if(!Number.isFinite(e)||e<=0){console.warn("setSpeed: 正の数値を指定してください。");return}this.options.interval=e,this.isPlaying&&(this.pause(),this.play().catch(i=>{console.error("再生速度変更後の再生に失敗しました:",i)}))}setLoop(e){this.options.loop=!!e}dispose(){this.stop(),this.mountEl.innerHTML="",this.preloadedImages=[],this.preloadPromise=null,this.isReady=!1}}r=new WeakSet,f=async function(){this.isReady||await this.preload()},g=function(){if(!this.preloadedImages.length)return;let e=this.currentIndex+1;if(e>=this.preloadedImages.length)if(this.options.loop)e=0;else{this.pause();return}this.currentIndex=e,o(this,r,d).call(this,this.currentIndex)},d=function(e){this.preloadedImages[e]&&(this.currentIndex=e,this.imageEl.src=this.preloadedImages[e].src)},y=function(e){const i=o(this,r,I).call(this,e);return new Promise((a,n)=>{const s=new Image;s.decoding="async",s.onload=async()=>{try{typeof s.decode=="function"&&await s.decode()}catch(l){console.warn("decode に失敗しましたが処理を継続します:",l)}a(s)},s.onerror=()=>n(new Error("画像の読み込みに失敗しました: ".concat(i))),s.src=i})},I=function(e){return"".concat(this.options.publicPath).concat(e,".").concat(this.options.extension)},P=function(e){const i={...u,...e||{}};return i.publicPath=o(this,r,E).call(this,i.publicPath),i.interval=o(this,r,x).call(this,i.interval),i},w=function(e){if(!e.mountId)throw new Error("mountId を指定してください。");if(!Array.isArray(e.imageNames)||e.imageNames.length===0)throw new Error("imageNames には1件以上のファイル名を指定してください。");if(!e.extension)throw new Error("extension を指定してください。")},E=function(e){return typeof e!="string"||e.length===0?u.publicPath:e.endsWith("/")?e:"".concat(e,"/")},x=function(e){const i=Number(e);return!Number.isFinite(i)||i<=0?u.interval:i};const N=Array.from({length:101},(t,e)=>"takasaki_".concat(String(e).padStart(4,"0"))),c=new L({mountId:"player",imageNames:N,extension:"jpeg",interval:80,loop:!0,publicPath:"/imgs/",autoPlay:!1});function h(t,e){const i=document.getElementById(t);if(!(i instanceof HTMLButtonElement)){console.warn("".concat(t," ボタンが見つかりませんでした。"));return}e(i)}h("preload-button",t=>{t.addEventListener("click",async()=>{var i;t.disabled=!0;const e=(i=t.textContent)!=null?i:"プリロード";t.textContent="プリロード中...";try{await c.preload(),t.textContent="プリロード完了"}catch(a){console.error("プリロードに失敗しました:",a),t.textContent="プリロード失敗"}finally{setTimeout(()=>{t.textContent=e,t.disabled=!1},600)}})});h("play-button",t=>{t.addEventListener("click",async()=>{var i;t.disabled=!0;const e=(i=t.textContent)!=null?i:"再生";t.textContent="再生準備中...";try{await c.play(),t.textContent="再生中"}catch(a){console.error("再生に失敗しました:",a),t.textContent="再生失敗"}finally{setTimeout(()=>{t.textContent=e,t.disabled=!1},400)}})});h("pause-button",t=>{t.addEventListener("click",()=>{c.pause()})});h("stop-button",t=>{t.addEventListener("click",()=>{c.stop()})});export{C as __vite_legacy_guard};
