System.register([],function(e,t){"use strict";return{execute:function(){var e=document.createElement("style");e.textContent=":root{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,sans-serif;background-color:#f6f8fa;color:#1f2328}body{margin:0;min-height:100vh}.demo{margin:0 auto;padding:24px 16px 40px;display:flex;flex-direction:column;gap:24px}.demo__header h1{margin:0 0 8px;font-size:1.8rem;line-height:1.2}.demo__lead{margin:0;line-height:1.6;font-size:.95rem}.demo__controls{display:flex;flex-direction:column;align-items:stretch;gap:10px}.demo__layout{display:flex;flex-direction:column;gap:24px}.demo__controls button{padding:12px 18px;border-radius:8px;border:1px solid #c3d0e0;background:#fff;color:inherit;font-size:1rem;transition:background-color .2s ease}.demo__controls button:hover:not(:disabled){background-color:#e9eff7}.demo__controls button:disabled{cursor:wait;opacity:.6}.demo__player{display:flex;justify-content:center}.demo__viewport{width:100%;max-width:720px;background:#111;border-radius:16px;border:1px solid #202020;overflow:hidden;display:grid;place-items:center;aspect-ratio:9/16}.demo__viewport canvas,.demo__viewport img{width:100%;height:100%;object-fit:contain;background:#111}.demo__notes ul{margin:0;padding-left:18px;line-height:1.6}.demo__notes li+li{margin-top:6px}.demo__footer{font-size:.9rem;color:#4a5568}@media (min-width: 600px){.demo{padding:32px 24px 56px;gap:28px}.demo__header h1{font-size:2.1rem}.demo__lead{font-size:1rem}.demo__controls{flex-direction:row;flex-wrap:wrap;gap:12px}.demo__controls button{flex:0 1 auto;min-width:140px}.demo__viewport{aspect-ratio:16/9;max-width:960px}}@media (min-width: 960px){.demo{max-width:1080px;padding:48px 32px 72px;gap:32px}.demo__layout{display:grid;grid-template-columns:360px 1fr;gap:32px;align-items:start}.demo__controls{flex-direction:row;align-items:center}.demo__viewport{border-radius:20px}}\n/*$vite$:1*/",document.head.appendChild(e);const t={extension:"webp",interval:100,loop:!0,publicPath:"/imgs/",autoPlay:!0,renderTarget:"canvas",fps:void 0,responsiveSwitching:!1};class i{constructor(e){if(this.options=this.#e(e),this.#t(this.options),this.mountEl=document.getElementById(this.options.mountId),!this.mountEl)throw new Error(`mountId="${this.options.mountId}" の要素が見つかりません。`);this.canvasEl=null,this.ctx=null,this.imageEl=null,this.mountEl.innerHTML="","canvas"===this.options.renderTarget?(this.canvasEl=document.createElement("canvas"),this.canvasEl.style.willChange="transform, opacity",this.canvasEl.style.display="block",this.canvasEl.style.width="100%",this.canvasEl.style.height="auto",this.mountEl.appendChild(this.canvasEl),this.ctx=this.canvasEl.getContext("2d",{alpha:!1})):(this.imageEl=document.createElement("img"),this.imageEl.decoding="async",this.imageEl.loading="eager",this.imageEl.style.display="block",this.imageEl.style.willChange="opacity",this.mountEl.appendChild(this.imageEl)),this.currentIndex=0,this.isPlaying=!1,this.isReady=!1,this.timerId=null,this.preloadPromise=null,this.preloadedFrames=[],this._frameInterval=1e3/(this.options.fps||1e3/this.options.interval),this._accumulator=0,this._lastTs=0,this._rafId=null,this.options.autoPlay&&this.preload().then(()=>this.play()).catch(e=>{console.error("自動再生に失敗しました:",e)})}async preload(){if(!this.isReady){if(!this.preloadPromise){const e="function"==typeof createImageBitmap;this.preloadPromise=Promise.all(this.options.imageNames.map(t=>this.#i(t,e)))}try{this.preloadedFrames=await this.preloadPromise,this.isReady=!0;const e=this.preloadedFrames[0];if(e){const{width:t,height:i}=await this.#n(e);if(this.canvasEl){const e=Math.max(1,Math.min(2,window.devicePixelRatio||1));this.canvasEl.width=Math.round(t*e),this.canvasEl.height=Math.round(i*e),this.canvasEl.style.aspectRatio=`${t} / ${i}`,this.ctx&&this.ctx.setTransform(e,0,0,e,0,0)}this.#a(0)}}catch(e){throw this.preloadPromise=null,e}}}async play(){if(this.isPlaying)return;if(await this.#r(),this.preloadPromise&&await this.preloadPromise,!this.preloadedFrames.length)return void console.warn("再生可能なフレームが見つかりません。");this.isPlaying=!0,this._lastTs=performance.now();const e=t=>{if(!this.isPlaying)return;const i=t-this._lastTs;for(this._lastTs=t,this._accumulator+=i;this._accumulator>=this._frameInterval;)this._accumulator-=this._frameInterval,this.#s();this._rafId=requestAnimationFrame(e)};this.#a(this.currentIndex),this._rafId=requestAnimationFrame(e)}pause(){this.isPlaying&&(this.isPlaying=!1,null!=this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=null),null!==this.timerId&&(clearInterval(this.timerId),this.timerId=null))}stop(){this.pause(),this.currentIndex=0,this.isReady&&this.preloadedFrames.length?this.#a(0):(this.imageEl&&this.imageEl.removeAttribute("src"),this.ctx&&this.canvasEl&&this.ctx.clearRect(0,0,this.canvasEl.width,this.canvasEl.height))}setSpeed(e){!Number.isFinite(e)||e<=0?console.warn("setSpeed: 正の数値を指定してください。"):(this.options.interval=e,this.options.fps=void 0,this._frameInterval=e)}setFps(e){!Number.isFinite(e)||e<=0?console.warn("setFps: 正の数値を指定してください。"):(this.options.fps=e,this._frameInterval=1e3/e)}setLoop(e){this.options.loop=Boolean(e)}dispose(){this.stop(),this.mountEl.innerHTML="";for(const e of this.preloadedFrames)if("close"in e&&"function"==typeof e.close)try{e.close()}catch{}this.preloadedFrames=[],this.preloadPromise=null,this.isReady=!1,this.canvasEl=null,this.ctx=null,this.imageEl=null}destroy(){this.dispose()}async#r(){this.isReady||await this.preload()}#s(){if(!this.preloadedFrames.length)return;let e=this.currentIndex+1;if(e>=this.preloadedFrames.length){if(!this.options.loop)return void this.pause();e=0}this.currentIndex=e,this.#a(this.currentIndex)}#a(e){const t=this.preloadedFrames[e];if(t)if(this.currentIndex=e,this.ctx&&this.canvasEl){const{width:e,height:i}=this.canvasEl;this.ctx.clearRect(0,0,e,i),ImageBitmap,this.ctx.drawImage(t,0,0,e,i)}else this.imageEl&&(t instanceof ImageBitmap?console.warn('renderTarget: "img" では ImageBitmap を直接表示できません。canvas を使用してください。'):this.imageEl.src=t.src)}async#i(e,t){const i=this.#o(e);try{const e=await fetch(i,{cache:"force-cache",credentials:"same-origin"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=await e.blob();if(t)return await createImageBitmap(n);{const e=URL.createObjectURL(n),t=new Image;t.decoding="async";const a=()=>{try{URL.revokeObjectURL(e)}catch{}};try{return await new Promise((n,a)=>{t.onload=n,t.onerror=()=>a(new Error(`画像の読み込みに失敗: ${i}`)),t.src=e}),"function"==typeof t.decode&&await t.decode(),t}finally{t.src=i,a()}}}catch(n){return await this.#l(i)}}#l(e){return new Promise((t,i)=>{const n=new Image;n.decoding="async",n.onload=async()=>{try{"function"==typeof n.decode&&await n.decode()}catch(e){console.warn("decode に失敗しましたが処理を継続します:",e)}t(n)},n.onerror=()=>i(new Error(`画像の読み込みに失敗しました: ${e}`)),n.src=e})}async#n(e){return e instanceof ImageBitmap?{width:e.width,height:e.height}:{width:e.naturalWidth,height:e.naturalHeight}}#o(e){return`${this.options.publicPath}${e}.${this.options.extension}`}#e(e){const i={...t,...e||{}};return i.publicPath=this.#c(i.publicPath),null!=i.fps&&Number.isFinite(Number(i.fps))&&Number(i.fps)>0?(i.fps=Number(i.fps),i.interval=1e3/i.fps):i.interval=this.#d(i.interval),"canvas"!==i.renderTarget&&"img"!==i.renderTarget&&(i.renderTarget=t.renderTarget),i}#t(e){if(!e.mountId)throw new Error("mountId を指定してください。");if(!Array.isArray(e.imageNames)||0===e.imageNames.length)throw new Error("imageNames には1件以上のファイル名を指定してください。");if(!e.extension)throw new Error("extension を指定してください。")}#c(e){return"string"!=typeof e||0===e.length?t.publicPath:e.endsWith("/")?e:`${e}/`}#d(e){const i=Number(e);return!Number.isFinite(i)||i<=0?t.interval:i}}const n=Array.from({length:101},(e,t)=>`takasaki_${String(t).padStart(4,"0")}`),a=function({variants:e,playerOptions:t,breakpointQuery:n,breakpointWidth:a,debounceMs:r}){const s=e??{},o=Object.keys(s),l=o;if(0===o.length)throw new Error("最小1種類の画像セットを指定してください。");const c=Object.prototype.hasOwnProperty.call(s,"desktop"),d=Object.prototype.hasOwnProperty.call(s,"mobile"),h=c?"desktop":o[0],m=n,p=Number.isFinite(a)?Number(a):900,u=Number.isFinite(r)?Number(r):150;let g=null,f=null,y=Boolean(t?.responsiveSwitching),w=null,v=null,x=!1,b=Promise.resolve();const _="undefined"!=typeof window;_&&"function"==typeof window.matchMedia&&(w=window.matchMedia(m));const E=e=>e&&d?"mobile":!e&&c?"desktop":h,I=()=>{if(!_)return h;if(w)return E(w.matches);const e=window.innerWidth||0;return E(e<=p)},P=async(e,{preserveState:n}={})=>{if(!e)return{player:g,variantKey:f};if(e===f&&g)return{player:g,variantKey:f};const a=s[e];if(!a)return console.warn(`未定義のvariant "${e}" が指定されました。`),{player:g,variantKey:f};const r=g,o=Boolean(n),l=o&&!0===r?.isPlaying,c=o&&!0===r?.isReady;if(r)try{r.destroy()}catch(h){console.warn("既存プレイヤーの破棄に失敗しました:",h)}const d=new i({...t,...a});if(g=d,f=e,c)try{await d.preload()}catch(h){console.error("プリロードの再実行に失敗しました:",h)}return l&&d.play().catch(e=>{console.error("切り替え後の再生再開に失敗しました:",e)}),{player:d,variantKey:e}},F=(e,t={})=>(b=b.catch(()=>{}).then(()=>P(e,t)).catch(e=>{console.error("画像バリアントの切り替えに失敗しました:",e)}),b),k=(e={})=>{_&&y&&(window.clearTimeout(v),v=window.setTimeout(()=>{const t=I();t&&t!==f&&F(t,e)},u))},L=()=>k({preserveState:!0}),T=()=>k({preserveState:!0}),S=()=>{_&&!x&&(x=!0,w&&("function"==typeof w.addEventListener?w.addEventListener("change",L):"function"==typeof w.addListener&&w.addListener(L)),window.addEventListener("resize",T))};_&&(b=P(I(),{preserveState:!1}),y&&S());const C=(e,t={})=>s[e]?F(e,t):(console.warn(`forceVariant: 未定義のvariant "${e}" が指定されました。`),Promise.resolve({player:g,variantKey:f}));return{getPlayer:()=>g,getVariant:()=>f,getVariants:()=>[...l],setResponsiveSwitching(e){const t=Boolean(e);t!==y&&(y=t,y?(S(),k({preserveState:!0})):_&&x&&(x=!1,window.clearTimeout(v),w&&("function"==typeof w.removeEventListener?w.removeEventListener("change",L):"function"==typeof w.removeListener&&w.removeListener(L)),window.removeEventListener("resize",T)))},forceVariant:C,cycleVariant:()=>{if(!l.length)return Promise.resolve({player:g,variantKey:f});const e=l.indexOf(f),t=e>=0?(e+1)%l.length:0,i=l[t];return C(i,{preserveState:!0})}}}({variants:{desktop:{imageNames:n,publicPath:"./imgs/desktop/"},mobile:{imageNames:n,publicPath:"./imgs/mobile/"}},playerOptions:{mountId:"player",extension:"jpeg",interval:80,loop:!0,autoPlay:!1,responsiveSwitching:!0},breakpointQuery:"(max-width: 900px)",breakpointWidth:900,debounceMs:150});function r(e,t){const i=document.getElementById(e);i instanceof HTMLButtonElement?t(i):console.warn(`${e} ボタンが見つかりませんでした。`)}r("preload-button",e=>{e.addEventListener("click",async()=>{const t=a.getPlayer();if(!t)return void console.warn("プレイヤーが初期化されていません。");e.disabled=!0;const i=e.textContent??"プリロード";e.textContent="プリロード中...";try{await t.preload(),e.textContent="プリロード完了"}catch(n){console.error("プリロードに失敗しました:",n),e.textContent="プリロード失敗"}finally{setTimeout(()=>{e.textContent=i,e.disabled=!1},600)}})}),r("play-button",e=>{e.addEventListener("click",async()=>{const t=a.getPlayer();if(!t)return void console.warn("プレイヤーが初期化されていません。");e.disabled=!0;const i=e.textContent??"再生";e.textContent="再生準備中...";try{await t.play(),e.textContent="再生中"}catch(n){console.error("再生に失敗しました:",n),e.textContent="再生失敗"}finally{setTimeout(()=>{e.textContent=i,e.disabled=!1},400)}})}),r("pause-button",e=>{e.addEventListener("click",()=>{const e=a.getPlayer();e?e.pause():console.warn("プレイヤーが初期化されていません。")})}),r("stop-button",e=>{e.addEventListener("click",()=>{const e=a.getPlayer();e?e.stop():console.warn("プレイヤーが初期化されていません。")})}),r("resize-button",e=>{e.addEventListener("click",async()=>{try{const t=await a.cycleVariant();t?.variantKey&&(e.textContent=`サイズ変更 (${t.variantKey})`)}catch(t){console.error("サイズ変更に失敗しました:",t)}})})}}});
